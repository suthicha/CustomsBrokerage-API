{"version":3,"sources":["../../src/controller/order.js"],"names":["squel","require","helper","httpMsg","db","settings","exports","getList","req","resp","sql","select","from","where","toString","execCommand","get","jobno","Error","ex","show500","addInvoice","inv","invDate","Date","InvDate","insert","into","set","JobNo","StringNull","InvNo","getFullYear","getMonth","getDate","CmpTaxNumber","CmpBranch","BuyerCode","BuyerName","Street","District","SubProvince","Province","PostCode","OriginCountry","NotifyPartyCode","NotifyPartyName","NotifyPartyAddr","DestinationCountry","IncoTerms","InvCurrency","NumberNull","TotalNetW","Totalinvoice","CurExpShp","CurExpFrg","CurExpIns","TotalExpShipping","TotalExpFreight","TotalExpInsurance","AvgExpShp","AvgExpFrg","AvgExpIns","AvgExp2Free","CurExpPacking","CurExpForInLand","CurExpLanding","CurExpOther","TotalExpPacking","TotalExpForInLand","TotalExpLanding","TotalExpOther","AvgExpPacking","AvgExpForInLand","AvgExpLanding","AvgExpOther","TermOfPayment","OtherRefNo","TransportMode","RefJobNo","executeSql","data","err","addInvoiceDetail","dtl","ItemNo","GroupCode","PdtCode","PdtSubCode","BrandName","ShippingMark","PdtDescription","DRemark","SeperateItem","GroupWithItem","IsFreeOfChage","TariffCode","TariffSeq","StatCode","RTCProductCode","ProductYear","WeightUnit","NetWeight","GrossWeight","TariffQty","TariffUnit","SalesPackUnit","SalesPackQty","SalesPrice","SalesTotalPrice","PackAmount","PackUnit","FormulaNo","BIS19TransferNo","BOILicenseNo","PermitNo","Privilege","PdtDescriptionThai","IsReImport","IsReExport","IsEPZ","IsComp","ImpDecNO","ImpDecItem","add","body","length","field","jobprefix","ordctl","arrivalDate","ArrivalDate","ShipmentType","TaxNumber","BranchNo","CompanyName","InvList","MasterBL","HouseBL","ConsCode","ConsName","TotalGrossW","Remark","CreateBy","dontQuote","ordctrlStatus","dtlArray","i","show200","update","table","DecNo","UpdateBy","ordctlStatus","delete","send"],"mappings":"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","file":"order.js","sourcesContent":["var squel = require('squel');\nvar helper = require('../core/helper');\nvar httpMsg = require('../core/httpMsg');\nvar db = require('../core/db');\nvar settings = require('../settings');\n\nexports.getList = function(req, resp) {\n    \n    var sql = squel.select()\n        .from(\"DTR_OrdControl\")\n        .where(\"JobStatus >= 1\")\n        .where(\"JobStatus <= 3\")\n        .toString();\n    helper.execCommand(req, resp, sql);\n}\n\nexports.get = function(req, resp, jobno) {\n    try {\n        if (!jobno) throw new Error(\"Input not valid\");\n\n        var sql = squel.select()\n            .from(\"DTR_OrdControl\")\n            .where(\"JobNo = ?\", jobno)\n            .toString();\n            \n            sql += \";\" + squel.select()\n            .from(\"DTR_OrdInvoice\")\n            .where(\"JobNo = ?\", jobno)\n            .toString();\n\n            sql += \";\" + squel.select()\n            .from(\"DTR_OrdInvDetail\")\n            .where(\"JobNo = ?\", jobno)\n            .toString();\n\n        helper.execCommand(req, resp, sql);\n\n    }catch (ex) {\n        httpMsg.show500(req, resp, ex);\n    }\n}\n\nfunction addInvoice(inv){\n    var invDate = new Date(inv.InvDate);\n    sql = squel.insert()\n        .into(\"DTR_OrdInvoice\")\n        .set(\"JobNo\", inv.JobNo)\n        .set(\"InvNo\", helper.StringNull(inv.InvNo))\n        .set(\"InvDate\", invDate.getFullYear() + \"-\" + (invDate.getMonth() + 1) +\"-\" + invDate.getDate())\n        .set(\"CmpTaxNumber\", helper.StringNull(inv.CmpTaxNumber))\n        .set(\"CmpBranch\", helper.StringNull(inv.CmpBranch))\n        .set(\"BuyerCode\", helper.StringNull(inv.BuyerCode))\n        .set(\"BuyerName\", helper.StringNull(inv.BuyerName))\n        .set(\"Street\", helper.StringNull(inv.Street))\n        .set(\"District\", helper.StringNull(inv.District))\n        .set(\"SubProvince\", helper.StringNull(inv.SubProvince))\n        .set(\"Province\", helper.StringNull(inv.Province))\n        .set(\"PostCode\", helper.StringNull(inv.PostCode))\n        .set(\"OriginCountry\", helper.StringNull(inv.OriginCountry))\n        .set(\"NotifyPartyCode\", helper.StringNull(inv.NotifyPartyCode))\n        .set(\"NotifyPartyName\", helper.StringNull(inv.NotifyPartyName))\n        .set(\"NotifyPartyAddr\", helper.StringNull(inv.NotifyPartyAddr))\n        .set(\"DestinationCountry\", helper.StringNull(inv.DestinationCountry))\n        .set(\"IncoTerms\", helper.StringNull(inv.IncoTerms))\n        .set(\"InvCurrency\", helper.StringNull(inv.InvCurrency))\n        .set(\"TotalNetW\", helper.NumberNull(inv.TotalNetW))\n        .set(\"Totalinvoice\", helper.NumberNull(inv.Totalinvoice))\n        .set(\"CurExpShp\", helper.StringNull(inv.CurExpShp))\n        .set(\"CurExpFrg\", helper.StringNull(inv.CurExpFrg))\n        .set(\"CurExpIns\", helper.StringNull(inv.CurExpIns))\n        .set(\"TotalExpShipping\", helper.NumberNull(inv.TotalExpShipping))\n        .set(\"TotalExpFreight\", helper.NumberNull(inv.TotalExpFreight))\n        .set(\"TotalExpInsurance\", helper.NumberNull(inv.TotalExpInsurance))\n        .set(\"AvgExpShp\", helper.StringNull(inv.AvgExpShp))\n        .set(\"AvgExpFrg\", helper.StringNull(inv.AvgExpFrg))\n        .set(\"AvgExpIns\", helper.StringNull(inv.AvgExpIns))\n        .set(\"AvgExp2Free\", helper.StringNull(inv.AvgExp2Free))\n        .set(\"CurExpPacking\", helper.StringNull(inv.CurExpPacking))\n        .set(\"CurExpForInLand\", helper.StringNull(inv.CurExpForInLand))\n        .set(\"CurExpLanding\", helper.StringNull(inv.CurExpLanding))\n        .set(\"CurExpOther\", helper.StringNull(inv.CurExpOther))\n        .set(\"TotalExpPacking\", helper.NumberNull(inv.TotalExpPacking))\n        .set(\"TotalExpForInLand\", helper.NumberNull(inv.TotalExpForInLand))\n        .set(\"TotalExpLanding\", helper.NumberNull(inv.TotalExpLanding))\n        .set(\"TotalExpOther\", helper.NumberNull(inv.TotalExpOther))\n        .set(\"AvgExpPacking\", helper.StringNull(inv.AvgExpPacking))\n        .set(\"AvgExpForInLand\", helper.StringNull(inv.AvgExpForInLand))\n        .set(\"AvgExpLanding\", helper.StringNull(inv.AvgExpLanding))\n        .set(\"AvgExpOther\", helper.StringNull(inv.AvgExpOther))\n        .set(\"TermOfPayment\", helper.StringNull(inv.TermOfPayment))\n        .set(\"OtherRefNo\", helper.StringNull(inv.OtherRefNo))\n        .set(\"TransportMode\", helper.StringNull(inv.TransportMode))\n        .set(\"RefJobNo\", helper.StringNull(inv.RefJobNo))\n        .toString();\n    db.executeSql(sql, function(data, err) {\n        if (err) throw new Error(\"Found error Insert DTR_OrdInvoice \" + err);\n    })\n}\n\nfunction addInvoiceDetail(dtl){\n    sql = squel.insert()\n        .into(\"DTR_OrdInvDetail\")\n        .set(\"JobNo\", dtl.JobNo)\n        .set(\"InvNo\", helper.StringNull(dtl.InvNo))\n        .set(\"ItemNo\", helper.NumberNull(dtl.ItemNo))\n        .set(\"GroupCode\", helper.StringNull(dtl.GroupCode))\n        .set(\"PdtCode\", helper.StringNull(dtl.PdtCode))\n        .set(\"PdtSubCode\", helper.StringNull(dtl.PdtSubCode))\n        .set(\"BrandName\", helper.StringNull(dtl.BrandName))\n        .set(\"ShippingMark\", helper.StringNull(dtl.ShippingMark))\n        .set(\"PdtDescriptonEng\", helper.StringNull(dtl.PdtDescription))\n        .set(\"DRemark\", helper.StringNull(dtl.DRemark))\n        .set(\"SeperateItem\", helper.NumberNull(dtl.SeperateItem))\n        .set(\"GroupWithItem\", helper.NumberNull(dtl.GroupWithItem))\n        .set(\"IsFreeOfChage\", helper.NumberNull(dtl.IsFreeOfChage))\n        .set(\"TariffCode\", helper.StringNull(dtl.TariffCode))\n        .set(\"TariffSeq\", helper.StringNull(dtl.TariffSeq))\n        .set(\"StatCode\", helper.StringNull(dtl.StatCode))\n        .set(\"RTCProductCode\", helper.StringNull(dtl.RTCProductCode))\n        .set(\"ProductYear\", helper.StringNull(dtl.ProductYear))\n        .set(\"WeightUnit\", helper.StringNull(dtl.WeightUnit))\n        .set(\"NetWeight\", helper.NumberNull(dtl.NetWeight))\n        .set(\"GrossWeight\", helper.NumberNull(dtl.GrossWeight))\n        .set(\"TariffQty\", helper.NumberNull(dtl.TariffQty))\n        .set(\"TariffUnit\", helper.StringNull(dtl.TariffUnit))\n        .set(\"SalesPackUnit\", helper.StringNull(dtl.SalesPackUnit))\n        .set(\"SalesPackQty\", helper.NumberNull(dtl.SalesPackQty))\n        .set(\"SalesPrice\", helper.NumberNull(dtl.SalesPrice))\n        .set(\"SalesTotalPrice\", helper.NumberNull(dtl.SalesTotalPrice))\n        .set(\"PackAmount\", helper.NumberNull(dtl.PackAmount))\n        .set(\"PackUnit\", helper.StringNull(dtl.PackUnit))\n        .set(\"FormulaNo\", helper.StringNull(dtl.FormulaNo))\n        .set(\"BIS19TransferNo\", helper.StringNull(dtl.BIS19TransferNo))\n        .set(\"BOILicenseNo\", helper.StringNull(dtl.BOILicenseNo))\n        .set(\"PermitNo\", helper.StringNull(dtl.PermitNo))\n        .set(\"Privilege\", helper.StringNull(dtl.Privilege))\n        .set(\"PdtDescriptionThai\", helper.StringNull(dtl.PdtDescriptionThai))\n        .set(\"IsReImport\", helper.NumberNull(dtl.IsReImport))\n        .set(\"IsReExport\", helper.NumberNull(dtl.IsReExport))\n        .set(\"IsEPZ\", helper.NumberNull(dtl.IsEPZ))\n        .set(\"IsComp\", helper.NumberNull(dtl.IsComp))\n        .set(\"ImpDecNO\", helper.StringNull(dtl.ImpDecNO))\n        .set(\"ImpDecItem\", helper.StringNull(dtl.ImpDecItem))\n        .toString();\n    db.executeSql(sql, function(data, err) {\n    })\n}\n\nexports.add = function(req, resp) {\n    try {\n        if(!req.body) throw new Error(\"Input not valid\");\n        if (req.body.length > 1e7) throw new Error(\"Request Entity too Large\");\n\n        var jobno = \"\";\n        var sql = squel.select()\n            .from(\"v_buildJobControl\")\n            .field(\"JobNo\")\n            .toString();\n        db.executeSql(sql, function(data, err) {\n            if (err){\n                httpMsg.show500(req, resp, err);\n            }\n            else {\n                if (data){\n                    jobno = settings.jobprefix + data[0].JobNo;\n                }\n            }\n        });\n\n        if (jobno) {\n            if (jobno == \"\") throw new Error(\"System cannot build JobNo.\");\n\n            var ordctl = req.body[0];\n            var arrivalDate = new Date(ordctl.ArrivalDate);\n            sql = squel.insert()\n                .into(\"DTR_OrdControl\")\n                .set(\"JobNo\", jobno)\n                .set(\"DecNo\", \"\")\n                .set(\"ShipmentType\", helper.StringNull(ordctl.ShipmentType))\n                .set(\"TaxNumber\", helper.StringNull(ordctl.TaxNumber))\n                .set(\"BranchNo\", helper.StringNull(ordctl.BranchNo))\n                .set(\"CompanyName\", helper.StringNull(ordctl.CompanyName))\n                .set(\"InvList\", helper.StringNull(ordctl.InvList))\n                .set(\"MasterBL\", helper.StringNull(ordctl.MasterBL))\n                .set(\"HouseBL\", helper.StringNull(ordctl.HouseBL))\n                .set(\"ArrivalDate\", arrivalDate.getFullYear() + '-' + (arrivalDate.getMonth()+1) + '-' + arrivalDate.getDate())\n                .set(\"TransportMode\", helper.StringNull(ordctl.TransportMode))\n                .set(\"IncoTerms\", helper.StringNull(ordctl.IncoTerms))\n                .set(\"ConsCode\", helper.StringNull(ordctl.ConsCode))\n                .set(\"ConsName\", helper.StringNull(ordctl.ConsName))\n                .set(\"TotalNetW\", helper.NumberNull(ordctl.TotalNetW))\n                .set(\"TotalGrossW\", helper.NumberNull(ordctl.TotalGrossW))\n                .set(\"WeightUnit\", helper.StringNull(ordctl.WeightUnit))\n                .set(\"PackAmount\", helper.NumberNull(ordctl.PackAmount))\n                .set(\"PackUnit\", helper.StringNull(ordctl.PackUnit))\n                .set(\"Totalinvoice\", helper.NumberNull(ordctl.Totalinvoice))\n                .set(\"InvCurrency\", helper.StringNull(ordctl.InvCurrency))\n                .set(\"JobStatus\", \"1\")\n                .set(\"Remark\", helper.StringNull(ordctl.Remark))\n                .set(\"CreateBy\", helper.StringNull(ordctl.CreateBy))\n                .set(\"CreateDate\", \"GETDATE()\", { dontQuote: true })\n                .set(\"UpdateBy\", \"\")\n                .set(\"UpdateDate\", \"19000101\")\n                .set(\"SendBy\", \"\")\n                .set(\"SendDate\", \"19000101\")\n                .toString();\n            var ordctrlStatus = false;\n            db.executeSql(sql, function(data, err) {\n                if (err){\n                    httpMsg.show500(req, resp, err);\n                }\n                else {\n                    ordctrlStatus = true;\n                }\n            });\n            \n            if (ordctrlStatus){\n                var inv = req.body[1];\n                inv.JobNo = jobno;\n                addInvoice(inv);\n            \n                var dtlArray = req.body[2];\n                if (dtlArray){\n                    \n                    for (var i = 0; i < dtlArray.length; i++) {\n                        var dtl = dtlArray[i];\n                        dtl.JobNo = jobno;\n                        addInvoiceDetail(dtl);\n                    }\n\n                } //end test invoice detail.\n\n                httpMsg.show200(req, resp);\n            } //end test insert order control complete.\n\n        }\n        \n    }catch (ex){\n        httpMsg.show500(req, resp, ex);\n    }\n}\n\nexports.update = function(req, resp) {\n    try {\n        if (!req.body) throw new Error(\"Input not valid\");\n        var ordctl = req.body[0];\n        var arrivalDate = new Date(ordctl.ArrivalDate);\n        var sql = squel.update()\n                .table(\"DTR_OrdControl\")\n                .set(\"DecNo\", helper.StringNull(ordctl.DecNo))\n                .set(\"ShipmentType\", helper.StringNull(ordctl.ShipmentType))\n                .set(\"TaxNumber\", helper.StringNull(ordctl.TaxNumber))\n                .set(\"BranchNo\", helper.StringNull(ordctl.BranchNo))\n                .set(\"CompanyName\", helper.StringNull(ordctl.CompanyName))\n                .set(\"InvList\", helper.StringNull(ordctl.InvList))\n                .set(\"MasterBL\", helper.StringNull(ordctl.MasterBL))\n                .set(\"HouseBL\", helper.StringNull(ordctl.HouseBL))\n                .set(\"ArrivalDate\", arrivalDate.getFullYear() + '-' + (arrivalDate.getMonth()+1) + '-' + arrivalDate.getDate())\n                .set(\"TransportMode\", helper.StringNull(ordctl.TransportMode))\n                .set(\"IncoTerms\", helper.StringNull(ordctl.IncoTerms))\n                .set(\"ConsCode\", helper.StringNull(ordctl.ConsCode))\n                .set(\"ConsName\", helper.StringNull(ordctl.ConsName))\n                .set(\"TotalNetW\", helper.NumberNull(ordctl.TotalNetW))\n                .set(\"TotalGrossW\", helper.NumberNull(ordctl.TotalGrossW))\n                .set(\"WeightUnit\", helper.StringNull(ordctl.WeightUnit))\n                .set(\"PackAmount\", helper.NumberNull(ordctl.PackAmount))\n                .set(\"PackUnit\", helper.StringNull(ordctl.PackUnit))\n                .set(\"Totalinvoice\", helper.NumberNull(ordctl.Totalinvoice))\n                .set(\"InvCurrency\", helper.StringNull(ordctl.InvCurrency))\n                .set(\"Remark\", helper.StringNull(ordctl.Remark))\n                .set(\"UpdateBy\", helper.StringNull(ordctl.UpdateBy))\n                .set(\"UpdateDate\", \"GETDATE()\", { dontQuote: true })\n                .where(\"JobNo = ?\", ordctl.JobNo)\n                .toString();\n\n            var ordctlStatus = false;    \n            db.executeSql(sql, function(data, err) {\n                if (err) throw new Error(\"Update Error\");\n                ordctlStatus = true;\n            }) \n\n            if (ordctlStatus){\n                var inv = req.body[1];\n                if (inv) {\n                    // delete invoice before insert new data.\n                    sql = squel.delete()\n                        .from(\"DTR_OrdInvoice\")\n                        .where(\"JobNo = ?\", inv.JobNo)\n                        .toString();\n                    db.executeSql(sql, function(data, err){\n                        if (err) throw new Error(\"Delete Order Invoice Error\");\n                        addInvoice(inv);\n                    })\n                }\n\n                var dtlArray = req.body[2];\n                if (dtlArray){\n                    // delete details before insert new data.\n                    sql = squel.delete()\n                        .from(\"DTR_OrdInvDetail\")\n                        .where(\"JobNo = ?\", inv.JobNo)\n                        .toString();\n                    db.executeSql(sql, function(data, err){\n                        if (err) throw new Error(\"Delete Order Invoice Detail Error\");\n                        \n                        for (var i = 0; i < dtlArray.length; i++) {\n                            addInvoiceDetail(dtlArray[i]);\n                        }\n\n                    });\n                }\n            }\n\n    }catch (ex) {\n        httpMsg.show500(req, resp, ex);\n    }\n}\n\nexports.delete = function(req, resp) {\n    try {\n        if (!req.body) throw new Error(\"Input not valid\");\n        var ordctl = req.body[0];\n\n        if(ordctl.JobNo){\n            var sql = squel.update()\n                .table(\"DTR_OrdControl\")\n                .set(\"JobStatus\", \"99\")\n                .where(\"JobNo = ?\", ordctl.JobNo)\n                .toString();\n            helper.execCommand(req, resp, sql);\n        }\n\n    }catch (ex) {\n        httpMsg.show500(req, resp, ex);\n    }\n}\n\nexports.send = function(req, resp) {\n    try {\n        if (!req.body) throw new Error(\"Input not valid\");\n        var ordctl = req.body[0];\n\n        if(ordctl.JobNo){\n            var sql = squel.update()\n                .table(\"DTR_OrdControl\")\n                .set(\"JobStatus\", \"2\")\n                .where(\"JobNo = ?\", ordctl.JobNo)\n                .toString();\n            helper.execCommand(req, resp, sql);\n        }\n\n    }catch (ex) {\n        httpMsg.show500(req, resp, ex);\n    }\n}"]}